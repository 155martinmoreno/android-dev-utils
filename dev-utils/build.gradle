import java.text.SimpleDateFormatapply plugin: 'com.android.library'/** * Returns the date formatted as "yyMMddHHmm" * * @return date string */def getBuildTime() {    def df = new SimpleDateFormat("yyMMddHHmm")    df.setTimeZone(TimeZone.getTimeZone("GMT-3"))    return df.format(new Date())}/** * Returns the current Branch name * * @return Branch name */def getBranchName() {    return "git rev-parse --abbrev-ref HEAD".execute().text.trim()}/** *  Fetch the version according to git latest tag and "how far are we from last tag" * * @return array with (gitTag, gitHowFar, gitSha) */def getGitTag() {    def longVersionName = "git describe --tags --long".execute().text.trim()    return longVersionName.tokenize('-')//Looking for something like "v0.7-13-gd86e254"}def branchName = getBranchName()def (gitTag, gitHowFar, gitSha) = getGitTag()def (versionMajor, versionMinor) = gitTag.tokenize('.')//Looking for git tag like "v0.1"def buildStrversionMajor = versionMajor.subSequence(1, versionMajor.length())//Removes the leading "v"def versionStr = "v$versionMajor.$versionMinor.$gitHowFar"if (branchName == "master") {    buildStr = "(${getBuildTime()})"} else {    buildStr = "(${branchName}_${getBuildTime()})"}if (branchName == "master" && gitHowFar.toInteger() > 0) {    throw new BuildCancelledException("This commit is NOT tagged", new Throwable("The repo is $gitHowFar commits away from the last tag ($gitTag)"));}android {    signingConfigs {        debug {            keyAlias 'debug'            keyPassword 'qwerty'            storeFile file('../debug.keystore')            storePassword 'qwerty'        }    }    compileSdkVersion 22    buildToolsVersion "22.0.1"    defaultConfig {        minSdkVersion 8        targetSdkVersion 22        //noinspection GroovyAssignabilityCheck        versionCode versionMajor.toInteger() * 100000 + versionMinor.toInteger() * 10000        versionName "${versionStr}${buildStr}"    }    buildTypes {        release {            minifyEnabled false            shrinkResources false            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'            signingConfig signingConfigs.debug        }        debug {            signingConfig signingConfigs.debug        }        libraryVariants.all { variant ->            variant.outputs.each { output ->                output.outputFile = new File(output.outputFile.parent.toString(), output.outputFile.name.replace(".aar", "_${versionStr}.aar"))            }        }    }    compileOptions {        sourceCompatibility JavaVersion.VERSION_1_7        targetCompatibility JavaVersion.VERSION_1_7    }}apply plugin: 'com.jfrog.bintray'apply plugin: 'com.github.dcendents.android-maven'apply plugin: 'com.jfrog.bintray'def siteUrl = 'https://github.com/155martinmoreno/android-dev-utils'bintray {    user = '155martinmoreno'    key = 'ccf3d20f7cc2867f9c7f8749a590c02042dd7de3'    configurations = ['archives'] //When uploading configuration files    pkg {        repo = 'maven'        userOrg = '155martinmoreno'        name = project.name        desc = ''        websiteUrl = siteUrl        issueTrackerUrl = 'https://github.com/155martinmoreno/android-dev-utils/issues'        vcsUrl = 'hhttps://github.com/155martinmoreno/android-dev-utils.git'        licenses = ['Apache-2.0']        labels = ['android', 'utils']        attributes = ['plat': ['android']]        publicDownloadNumbers = true        version {            name = android.defaultConfig.versionCode            desc = android.defaultConfig.versionName            released = new Date()        }    }}install {    repositories.mavenInstaller {        pom {            project {                packaging 'aar'                name project.name                url siteUrl                licenses {                    license {                        name 'The Apache Software License, Version 2.0'                        url 'http://www.apache.org/licenses/LICENSE-2.0.txt'                    }                }                developers {                    developer {                        id 'tinchoApps'                        name 'Martin Moreno'                        email '155martinmoreno@gmail.com'                    }                }                scm {                    connection siteUrl                    developerConnection siteUrl                    url siteUrl                }            }        }    }}task sourcesJar(type: Jar) {    from android.sourceSets.main.java.srcDirs    classifier = 'sources'}task javadoc(type: Javadoc) {    source = android.sourceSets.main.java.srcDirs    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))}task javadocJar(type: Jar, dependsOn: javadoc) {    classifier = 'javadoc'    from javadoc.destinationDir}artifacts {    archives javadocJar    archives sourcesJar}task findConventions << {    println project.getConvention()}dependencies {    compile fileTree(include: ['*.jar'], dir: 'libs')    compile 'com.android.support:support-annotations:20.0.0'    compile 'com.android.support:support-v4:22.1.1'}